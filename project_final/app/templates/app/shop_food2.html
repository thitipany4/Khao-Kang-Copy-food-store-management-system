<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
            body {
                    background-color: #f5f5f7;
                }
            .container {
                display: flex;
                flex-direction: column;
                /* border: 1px solid red; */
                margin: 10px;
                /* align-items: center; */

            }
            .head_detail {
                display: flex;
                flex-direction: column;
                /* border: 1px solid red; */
                width: 1100px;
                height: 70px;
                margin-bottom: 40px;
            }
            .head_title {
                font-size: 24px;
                width: 250px;
                padding: 7px;
                text-align: center;
                /* border: 1px solid red; */
                box-shadow: transparent 0 0 0 3px,rgba(18, 18, 18, .1) 0 6px 20px;
                border-radius: 0.3rem;
                background-color: #F94D4D;
                margin-bottom: 10px;
            }
            .detail {
                font-size: 24px;
                margin-bottom: 5px;
            }
            .line {
                border-bottom: 1px solid #212122;

            }
            .container-show {
                display: flex;
                /* border: 1px solid rebeccapurple; */


            }
            .container-area {
                display: grid;
                padding: 0.5rem;
                margin: 0.5rem;
                grid-template-columns: repeat(3,1fr);
                grid-gap: 10px;
                width: 800px;
                margin-top: 1px;
                margin-right: 60px;
                /* border: 1px solid red; */
                margin-bottom: 30px;
                background-color: #FDFDFD;


             }

             .boxlistfood {
                 border: 1px solid #E5E5E5;
                 margin-top: 20px;
                 width: 220px;
                 height: 200px;
                 box-shadow: transparent 0 0 0 3px,rgba(18, 18, 18, .1) 0 6px 20px;


             }
             .boxlistfood div {

                 text-align: center;
                 margin-bottom: 10px;

             }
             .listitem a {
                 text-decoration: none;
                 color: black;
             }
             .image-food {
                 width: 100% ;
                 border-radius: 1rem;
                 height: 110px;
                 margin-bottom: 20px;


             }
             .image-food img {
                 height: 130px; /* Set the height of the image container */
                 width: 99.5%; /* Set the width of the image container */



             }
             .detail_food {
                 display: flex;
                 justify-content: space-between;
                 margin-left: 10px;
                 margin-bottom: 0;
                 /* border: 1px solid red; */
             }
             .food-quantity {
            margin-right: 20px;
        }
             .name {
                 margin-top: 5px;
                 margin-bottom: 0;
             }

             .box-detail {
                 display: flex;
                 flex-direction: column;
                 border-radius: 0.3rem;
                 height: 70px;
                 position: relative;
                 margin-top: 20px;
                 /* border: 1px solid red; */
                 background-color: #FDFDFD;

             }

             .overlay {
                 position: absolute;
                 top: 17px;
                 left: 182px;
                 transform: translate(-50%, -50%);
                 padding: 10px;
                 border-radius: 5px;
                 width: 30px;
     }
             .check_box {
                 background-color: greenyellow; /* Change the background color and opacity as needed */
                 display: inline-block;
                 padding: 6px;
                 width: 40px;
                 height: 20px;
                 border-radius: 0.5rem;
             }
             .submit_box {
                display: flex;
                width: 400px;
                flex-direction: column;
                /* border: 1px solid red; */
                align-items: center;
             }
             .button_area {
                display: flex;
                /* border: 1px solid orange; */
                background-color: #FDFDFD;
                box-shadow: transparent 0 0 0 3px,rgba(18, 18, 18, .1) 0 6px 20px;
                flex-direction: column;
                width: 80%;
                height: 200px;
                margin-top: 20px;
                /* justify-content: center; */
                align-items: center;
             }
            .checkbox_form {
                /* border: 1px solid red; */
                display: flex;
                width: 250px;
                margin-top: 20px;
                margin-bottom: 10px;
                font-size: 20px;

             }
            .checkbox-btn {
                width: 20px;
            }
             .quantity-control {
                display: flex;
                /* border: 1px solid blue; */
                width: 250px;
                align-items: center;
                margin-bottom: 10px;


             }
             .quantity-label {
                margin-right: 10px;
                font-size: 18px;

             }
             .btn_l,.btn_r {
                border: 1px solid black;
                background-color: #FDFDFD;
                margin-left: 5px;
                margin-right: 5px;
                border-radius: 0.2rem;
             }
             .btn_l:hover,.btn_r:hover {
                background-color: #3498db;

             }
             .quantity_input {
                width: 50px;
             }
             .box-submit {
                display: flex;
                /* border: 1px solid tomato; */
                width: 250px;
                height: 70px;
                justify-content: space-between;
                align-items: center;
 

    }

            .button-btn,.cancel-btn{
                display: flex;
                justify-content: center;
                align-items: center;
                width: 100px;
                height: 40px;
                border-radius: 4px;
                text-decoration: none;
                color: white;
                margin-left: 10px;
                margin-right: 10px;
        }
            .button-btn {
                    border: 1px solid #3498db;
                    background-color: #3498db;
                }

            .cancel-btn {
                    border: 1px solid #F94D4D;
                    background-color: #F94D4D;

                }
</style>
</head>
<body>
    {% include 'app/navbar.html' %}
    {%if not selected %}
        <div class="container">
            <div class="head_detail">
                <div class="head_title">สั่งจองรูปแบบกล่อง</div>
                <div class="detail">เลือกได้มากที่สุด 2 อย่าง 40 บาท พิเศษ 50 บาท</div>
                <div class="line"></div>
            </div>
            <div class="container-show">
                <div class="container-area">
                    {%for f in food %}
                        {%if f.food.options != 'notchoose'%}
                        <div class="listitem">

                                <div class="boxlistfood">
                                    {%if f.food.image %}
                                    <div class="image-food">
                                        <img src="{{f.food.image.url}}" alt="food-image">
                                    </div>
                                    {%endif%}

                                    <div class="box-detail">
                                        <div class="overlay">
                                            <form class="add-to-cart-form" method="post" action="#">
                                                {% csrf_token %}
                                                <input type="hidden" name="product_id" value="{{ f.food.id }}">
                                                <input class="check_box" type="checkbox" name="add_to_cart">
                                            </form>
                                        </div>

                                        <div class="name">{{f.food.name}}</div>
                                        <div class="detail_food">
                                            <div class="food-price">{{f.food.price}} {{f.food.unit}}</div>
                                            <div class="food-quantity">คงเหลือ : {{f.quantity}}</div>

                                        </div>

                                    </div>

                                </div>

                        </div>
                        {%endif%}

                    {%endfor%}
                </div>

                <div class="submit_box">
                    <div class="button_area">
                        <form class="checkbox_form" method="post" action="#">
                            {% csrf_token %}
                            <label class="special">
                                Special
                            </label>
                            <input class="checkbox-btn" type="checkbox" name="special" value="selected">
                        </form>
                        <form class="add-to-cart-form2" method="post" action="#">
                            {% csrf_token %}
                            
                            <div class="quantity-control">
                                <label class="quantity-label">จำนวน</label>
                                <button class="btn_l" type="button" onclick="decrementQuantity('{{ f.id }}')">-</button>
                                <input class="quantity_input" type="number" name="quantity" id="id_quantity_{{ product.id }}" value="1" min="0">
                                <button class="btn_r" type="button" onclick="incrementQuantity('{{ f.id }}')">+</button>
                            </div>

                        </form>
                        <div class="box-submit">
                            <button class="button-btn" type="button" onclick="submitForms()">จองอาหาร</button>
                            <a class="cancel-btn" href="/view-cart/">cancel</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    {%endif%}

    {%if selected %}
      <div class="container">
        <div class="head_detail">
            <div class="head_title">สั่งจองรูปแบบกล่อง</div>
            <div class="detail">เลือกได้มากที่สุด 2 อย่าง 40 บาท พิเศษ 50 บาท</div>
            <div class="line"></div>
        </div>
        <div class="container-show">
            <div class="container-area">
                {%for f in food %}
                    {%if f.food.options != 'notchoose'%}
                    <div class="listitem">
                            <div class="boxlistfood">
                                {%if f.food.image %}
                                <div class="image-food">
                                    <img src="{{f.food.image.url}}" alt="food-image">
                                </div>
                                {%endif%}
                                <div class="box-detail">
                                    <div class="overlay">
                                        <form class="add-to-cart-form" method="post" action="#">
                                            {% csrf_token %}
                                            <input type="hidden" name="product_id" value="{{ f.food.id }}">
                                            {% if f.food.id in selected %}
                                                <input class="check_box" type="checkbox" name="add_to_cart" checked>
                                            {% else %}
                                                <input class="check_box" type="checkbox" name="add_to_cart">
                                            {% endif %}
                                            </form>
                                    </div>

                                    <div class="name">{{f.food.name}}</div>
                                    <div class="detail_food">
                                        <div class="food-price">{{f.food.price}} {{f.food.unit}}</div>
                                        <div class="food-quantity">คงเหลือ : {{f.quantity}}</div>

                                    </div>
                                </div>
                            </div>
                        </div>
                    {%endif%}
                {%endfor%}

            </div>

            <div class="submit_box">
                <div class="button_area">
                    <form class="checkbox_form" method="post" action="#">
                            {% csrf_token %}
                            {%if special == 'True'%}
                            <label class="special">
                                Special
                                <input class="checkbox-btn"  type="checkbox" name="special" value="selected" checked>
                            </label>
                            {%else%}
                            <label class="special">
                                Special
                                <input class="checkbox-btn"  type="checkbox" name="special" value="selected">
                            </label>
                            {%endif%}
                        </form>

                        <form class="add-to-cart-form2" method="post" action="#">
                        {% csrf_token %}
                        <div class="quantity-control">
                            <label class="quantity-label">จำนวน</label>
                            <button class="btn_l" type="button" onclick="decrementQuantity('{{ f.id }}')">-</button>
                            <input class="quantity_input"  class="quantity_input" type="number" name="quantity" id="id_quantity_{{ product.id }}" value="{{item.quantity}}" min="0">
                            <button class="btn_r" type="button" onclick="incrementQuantity('{{ f.id }}')">+</button>
                            </div>
                        </form>

                        <div class="box-submit">
                            <button class="button-btn" type="button" onclick="submitForms_modify()">จองอาหาร</button>
                            <a class="cancel-btn" href="/view-cart/">cancel</a>
                        </div>
                        
                </div>
            </div>

    {%endif%}


    <script>
        const typeValue = "type2";
        const modifyValue = "{{modify}}";
        function submitForms() {
            const forms = document.querySelectorAll('.add-to-cart-form, .add-to-cart-form2,.checkbox_form');
            const formData = new FormData();
            let addToCartCount = 0;
            let exceededLimit = false;

            forms.forEach(form => {
                const formInputs = form.querySelectorAll('input');

                formInputs.forEach(input => {
                    if (input.type === 'checkbox') {
                        if (input.checked) {
                            if (input.name === 'add_to_cart') {
                                // Check if 'add_to_cart' checkbox count exceeds 2
                                if (addToCartCount >= 2) {
                                    alert('You can only select up to 2 products for add_to_cart.');
                                    exceededLimit = true;
                                } else {
                                    addToCartCount++;
                                }
                            }
                            formData.append(input.name, 'checked');
                        } else {
                            formData.append(input.name, 'not checked');
                        }
                    } else if (input.type === 'number') {
                        // Include the quantity value in the form data
                        formData.append('quantity', input.value);
                    } else {
                        formData.append(input.name, input.value);
                    }
                });
            });
            if (exceededLimit) {
                return; // Exit the function if limit exceeded
            }
            if (addToCartCount === 0) {
                alert('You must choose products for add_to_cart.');
                return; // Exit the function if no products selected
            }

            fetch('/add-to-cart/' + typeValue + '/' ,{
                method: 'POST',
                body: formData,
            })
            .then(response => {
                if (response.ok) {
                    const homeURL = "{% url 'view_cart' %}";
                    window.location.href = homeURL;
                }
            });
        }
        function submitForms_modify() {
            const forms = document.querySelectorAll('.add-to-cart-form, .add-to-cart-form2,.checkbox_form');
            const formData = new FormData();
            let addToCartCount = 0;
            let exceededLimit = false;

            forms.forEach(form => {
                const formInputs = form.querySelectorAll('input');

                formInputs.forEach(input => {
                    if (input.type === 'checkbox') {
                        if (input.checked) {
                            if (input.name === 'add_to_cart') {
                                // Check if 'add_to_cart' checkbox count exceeds 2
                                if (addToCartCount >= 2) {
                                    alert('You can only select up to 2 products for add_to_cart.');
                                    exceededLimit = true; // Flag that limit has been exceeded
                                } else {
                                    addToCartCount++;
                                }
                            }
                            formData.append(input.name, 'checked');
                        } else {
                            formData.append(input.name, 'not checked');
                        }
                    } else if (input.type === 'number') {
                        // Include the quantity value in the form data
                        formData.append('quantity', input.value);
                    } else {
                        formData.append(input.name, input.value);
                    }
                });
            });

            if (exceededLimit) {
                return; // Exit the function if limit exceeded
            }

            if (addToCartCount === 0) {
                alert('You must choose products for add_to_cart.');
                return; // Exit the function if no products selected
            }

            // If addToCartCount does not exceed 2 and there are selected products, submit the form
            fetch('/add-to-cart/' + typeValue + '/' + modifyValue + '/', {
                method: 'POST',
                body: formData,
            })
            .then(response => {
                if (response.ok) {
                    const homeURL = "{% url 'view_cart' %}";
                    window.location.href = homeURL;
                }
            });
        }

        function incrementQuantity(productId) {
            var quantityInput = document.getElementById("id_quantity_" + productId);
            quantityInput.value = parseInt(quantityInput.value) + 1;
        }

        function decrementQuantity(productId) {
            var quantityInput = document.getElementById("id_quantity_" + productId);
            var currentQuantity = parseInt(quantityInput.value);
            quantityInput.value = currentQuantity > 0 ? currentQuantity - 1 : 0;
        }
    </script>



</body>
</html>